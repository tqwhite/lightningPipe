'use strict';
var qtools = require('qtools');
qtools = new qtools(this);

module.exports = function(sqlizer) {
	//NOTE: this is called from an assembler. "this" refers to the assembler's scope.

	sqlizer.setBaseTable('Section_Student');

	sqlizer.mapColumns({

		"Section_Student.studentUniqueIdentifier": function(record) {
			var value = record.Section_Student.localStudentIdentifier.substr(3);
			return value;
		}
	});

	var courseSectionJoin = function(baseElement, joinedElement) {



		
		
// 
// if (baseElement.studentUniqueIdentifier == '2023088' && baseElement.courseNumber == joinedElement.courseNumber &&
// 	baseElement.sectionNumber == joinedElement.sectionNumber
// ) {
// 
// 	console.log(baseElement.courseNumber + "==" + joinedElement.courseNumber + "&&" + baseElement.sectionNumber + "==" + joinedElement.sectionNumber);
// }



		if (baseElement.courseNumber && baseElement.sectionNumber && (baseElement.courseNumber == joinedElement.courseNumber &&
			baseElement.sectionNumber == joinedElement.sectionNumber
		)) {
			return true;
		} else {

			return false;
		}
	}

	sqlizer.innerJoin('courseNumber', 'Section_Staff', courseSectionJoin);

	 

// var tmp=qtools.getByProperty(sqlizer.workingTable, 'Section_Student.courseNumber', '010-116');
// qtools.die(qtools.errorObject("sqlizer.workingTable[0].Section_Student.sectionNumber", sqlizer.workingTable[0].Section_Student.sectionNumber));
	
	sqlizer.innerJoin('courseNumber', 'Section', courseSectionJoin);

	sqlizer.innerJoin('courseNumber', 'Course', 'courseNumber');

	var result = sqlizer.getResult();

	return result;


}
